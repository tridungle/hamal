{"ast":null,"code":"import Event from \"./internal/net/Event\";\nimport StitchEvent from \"./internal/net/StitchEvent\";\n\nvar Stream = function () {\n  function Stream(eventStream, decoder) {\n    this.eventStream = eventStream;\n    this.decoder = decoder;\n    this.listeners = [];\n  }\n\n  Stream.prototype.next = function () {\n    var _this = this;\n\n    return this.eventStream.nextEvent().then(function (event) {\n      var se = StitchEvent.fromEvent(event, _this.decoder);\n\n      if (se.eventName === StitchEvent.ERROR_EVENT_NAME) {\n        throw se.error;\n      }\n\n      if (se.eventName === Event.MESSAGE_EVENT) {\n        return se.data;\n      }\n\n      return _this.next();\n    });\n  };\n\n  Stream.prototype.onNext = function (callback) {\n    var _this = this;\n\n    var wrapper = {\n      onEvent: function (e) {\n        var se = StitchEvent.fromEvent(e, _this.decoder);\n\n        if (se.eventName !== Event.MESSAGE_EVENT) {\n          return;\n        }\n\n        callback(se.data);\n      }\n    };\n    this.eventStream.addListener(wrapper);\n  };\n\n  Stream.prototype.onError = function (callback) {\n    var _this = this;\n\n    var wrapper = {\n      onEvent: function (e) {\n        var se = StitchEvent.fromEvent(e, _this.decoder);\n\n        if (se.eventName === StitchEvent.ERROR_EVENT_NAME) {\n          callback(se.error);\n        }\n      }\n    };\n    this.eventStream.addListener(wrapper);\n  };\n\n  Stream.prototype.addListener = function (listener) {\n    var _this = this;\n\n    var wrapper = {\n      onEvent: function (e) {\n        var se = StitchEvent.fromEvent(e, _this.decoder);\n\n        if (se.eventName === StitchEvent.ERROR_EVENT_NAME) {\n          if (listener.onError) {\n            listener.onError(se.error);\n          }\n        } else {\n          if (listener.onNext) {\n            listener.onNext(se.data);\n          }\n        }\n      }\n    };\n    this.listeners.push([listener, wrapper]);\n    this.eventStream.addListener(wrapper);\n  };\n\n  Stream.prototype.removeListener = function (listener) {\n    var index = -1;\n\n    for (var i = 0; i < this.listeners.length; i++) {\n      if (this.listeners[i][0] === listener) {\n        index = i;\n        break;\n      }\n    }\n\n    if (index === -1) {\n      return;\n    }\n\n    var wrapper = this.listeners[index][1];\n    this.listeners.splice(index, 1);\n    this.eventStream.removeListener(wrapper);\n  };\n\n  Stream.prototype.isOpen = function () {\n    return this.eventStream.isOpen();\n  };\n\n  Stream.prototype.close = function () {\n    this.eventStream.close();\n  };\n\n  return Stream;\n}();\n\nexport default Stream;","map":null,"metadata":{},"sourceType":"module"}